<div
    id="gp-step-tm-mgr"
    [@animate]="{ value: '*', params: { y: '100%' } }"
    fxLayout="row"
    fxFlex="100"
    class="widget widget5"
>
    <div class="fuse-widget-front">
        <div
            class="px-16 border-bottom accent"
            fxLayout="row"
            fxLayoutAlign="space-between center"
        >
            <div class="h3">Team Availability</div>
            <!-- 
            <div class="h3">
                {{ currentGen.title }} | ISO:
                {{ currentGen.iso }}
            </div> -->
            <div fxLayout="row">
                <button class="mt-8" mat-icon-button [matMenuTriggerFor]="menu">
                    <mat-icon>more_vert</mat-icon>
                </button>
                <div fxLayout="row">
                    <form [formGroup]="teamCatSelectionFormGroup">
                        <mat-form-field floatLabel="never">
                            <mat-select
                                placeholder="Filter Team Category"
                                formControlName="teamCategory"
                                [compareWith]="compareCategories"
                            >
                                <mat-option [value]="'all'">
                                    --- ALL Categories ---
                                </mat-option>
                                <mat-option
                                    *ngFor="let teamCat of teamCategories"
                                    [value]="teamCat"
                                >
                                    {{ teamCat.teamType }}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </form>

                    <button
                        class="mt-8"
                        mat-icon-button
                        [matMenuTriggerFor]="menu"
                    >
                        <mat-icon>more_vert</mat-icon>
                    </button>
                    <mat-menu #menu="matMenu">
                        <button mat-menu-item (click)="addModifyTeamCategory()">
                            <mat-icon>alarm_add</mat-icon>
                            <span>New Team Category</span>
                        </button>
                        <button
                            mat-menu-item
                            [disabled]="!currentCategory"
                            (click)="addModifyTeamCategory(currentCategory)"
                        >
                            <mat-icon>alarm_on</mat-icon>
                            <span>Modify Category Info</span>
                        </button>
                    </mat-menu>
                </div>
            </div>
        </div>
        <div class="content">
                <table mat-table
                [dataSource]="dataSource" multiTemplateDataRows
                class="mat-elevation-z8">
              <ng-container matColumnDef="{{column}}" *ngFor="let column of oKeys(teamColumnDef)">
                    <th mat-header-cell *matHeaderCellDef> {{teamColumnDef[column][0]}} </th>
                    <td mat-cell *matCellDef="let team"> {{teamColumnDef[team[column][1]]}} </td>
                  </ng-container>
         
           <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
           <ng-container matColumnDef="expandedDetail">
             <td mat-cell *matCellDef="let team" [attr.colspan]="oKeys(teamColumnDef).length">
               <div class="example-element-detail"
                    [@detailExpand]="team == expandedTeam ? 'expanded' : 'collapsed'">
                    <div mat-dialog-content class="pb-0 pt-20 m-0" fusePerfectScrollbar>
                            <form [formGroup]="tmAvailFormGroup">
                                <div fxLayout="row" fxLayoutAlign="start start">
                                    <mat-form-field appearance="outline" fxFlex>
                                        <mat-label>Shift Start Date</mat-label>
                                        <mat-icon
                                            [owlDateTimeTrigger]="availDatePicker"
                                            matSuffix
                                            class="secondary-text"
                                            >date_range</mat-icon
                                        >
                                        <input
                                            matInput
                                            name="availDate"
                                            formControlName="availDate"
                                            placeholder="Select Day"
                                            [selectMode]="'single'"
                                            [owlDateTime]="availDatePicker"
                                            [min]="generationStart"
                                            [max]="generationStop"
                                        />
                                        <owl-date-time
                                            [pickerMode]="'dialog'"
                                            [startAt]="defaultStart"
                                            [stepMinute]="30"
                                            [panelClass]="'dateDialog'"
                                            #availDatePicker
                                        ></owl-date-time>
                                    </mat-form-field>
                                </div>
                            </form>
                        </div>
                        <div mat-dialog-content class="pb-0 pt-10 m-0" fusePerfectScrollbar>
                            <form [formGroup]="tmAvailFormGroup">
                                <div fxLayout="row" fxLayoutAlign="space-between start">
                                    <mat-form-field appearance="outline" fxFlex="48">
                                        <mat-label>Number of Hours</mat-label>
                    
                                        <input
                                            matInput
                                            name="numOfHours"
                                            formControlName="numOfHours"
                                            placeholder="How Many Hours?"
                                            type="number"
                                        />
                                    </mat-form-field>
                                    <mat-form-field appearance="outline" fxFlex="48">
                                        <mat-label>Repeat</mat-label>
                                        <input
                                            matInput
                                            name="repeatNum"
                                            type="number"
                                            formControlName="repeatNum"
                                            placeholder="Days to Repeat"
                                        />
                                        <mat-hint
                                            >{{ numberOfDaysLeft }} days left during
                                            Generation</mat-hint
                                        >
                                    </mat-form-field>
                                </div>
                            </form>
                        </div>
                        <div
                            mat-dialog-actions
                            class="m-0 p-16"
                            fxLayout="row"
                            fxLayoutAlign="end center"
                        >
                            <button
                                mat-stroked-button
                                color="accent"
                                class="save-button"
                                (click)="addAvailability()"
                                [disabled]="tmAvailFormGroup.invalid"
                                aria-label="SAVE"
                            >
                                ADD
                            </button>
                        </div>
                        <mat-divider></mat-divider>
                    
                        <div class="tm-avail-list-container">
                            <div class="tm-avail-list-table-container">
                                <table
                                    mat-table
                                    [dataSource]="tmAvailDataSource"
                                    [trackBy]="id"
                                    class="example-table"
                                    matSort
                                    matSortActive="availStart"
                                    matSortDirection="asc"
                                >
                                    <!-- Checkbox Column -->
                                    <ng-container matColumnDef="select">
                                        <th mat-header-cell *matHeaderCellDef>
                                            <mat-checkbox
                                                (change)="$event ? masterToggle() : null"
                                                [checked]="selection.hasValue() && isAllSelected()"
                                                [indeterminate]="
                                                    selection.hasValue() && !isAllSelected()
                                                "
                                            >
                                            </mat-checkbox>
                                        </th>
                                        <td mat-cell *matCellDef="let teamAvail">
                                            <mat-checkbox
                                                (click)="$event.stopPropagation()"
                                                (change)="
                                                    $event ? selection.toggle(teamAvail) : null
                                                "
                                                [checked]="selection.isSelected(teamAvail)"
                                            >
                                            </mat-checkbox>
                                        </td>
                                    </ng-container>
                    
                                    <!-- Id Column -->
                                    <ng-container matColumnDef="id">
                                        <th mat-header-cell *matHeaderCellDef>ID</th>
                                        <td mat-cell *matCellDef="let teamAvail">
                                            {{ teamAvail.id }}
                                        </td>
                                    </ng-container>
                    
                                    <!-- AvailStart Column -->
                                    <ng-container matColumnDef="availStart">
                                        <th mat-header-cell *matHeaderCellDef>Availabilty Start</th>
                                        <td mat-cell *matCellDef="let teamAvail">
                                            {{ teamAvail.availStart | date: 'd-MMM-yy HHMM' }}
                                        </td>
                                    </ng-container>
                    
                                    <!-- AvailEnd Column -->
                                    <ng-container matColumnDef="availEnd">
                                        <th mat-header-cell *matHeaderCellDef>Availability End</th>
                                        <td mat-cell *matCellDef="let teamAvail">
                                            {{ teamAvail.availEnd | date: 'd-MMM-yy HHMM' }}
                                        </td>
                                    </ng-container>
                    
                                    <!-- Duration Column -->
                                    <ng-container matColumnDef="duration">
                                        <th mat-header-cell *matHeaderCellDef>Duration</th>
                                        <td mat-cell *matCellDef="let teamAvail">
                                            {{ calcuateHours(teamAvail.manHoursAvail) }} hours
                                        </td>
                                    </ng-container>
                    
                                    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                                    <tr
                                        mat-row
                                        *matRowDef="let teamAvail; columns: displayedColumns"
                                    ></tr>
                                </table>
                            </div>
                    
                            <mat-paginator
                                [length]="tmAvailDataSource?.data?.length"
                                #paginator
                                [pageIndex]="0"
                                [pageSize]="10"
                            ></mat-paginator>
                        </div>
                        <mat-divider></mat-divider>
                        <div
                            mat-dialog-actions
                            class="m-0 p-16"
                            fxLayout="row"
                            fxLayoutAlign="start center"
                        >
                            <button
                                mat-button
                                class="save-button"
                                (click)="close()"
                                aria-label="SAVE"
                            >
                                DONE
                            </button>
                            <button
                                *ngIf="selection.hasValue()"
                                mat-button
                                class="mr-8"
                                (click)="deleteTeamAvailabilites()"
                                aria-label="Delete"
                                matTooltip="Delete"
                            >
                                DELETE
                            </button>
                        </div>
               </div>
             </td>
           </ng-container>
         
           <tr mat-header-row *matHeaderRowDef="teamTableColumnDefs"></tr>
           <tr mat-row *matRowDef="let team; columns: teamTableColumnDefs;"
               class="example-element-row"
               [class.example-expanded-row]="expandedTeam === team"
               (click)="expandedTeam = team">
           </tr>
           <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="example-detail-row"></tr>
         </table>
        </div>
        <div class="no-team" *ngIf="filteredTeams.length === 0">
            No teams found!
        </div>

        <mat-divider></mat-divider>

        <div class="pt-12">
            <button mat-raised-button matStepperNext>
                Next: Assets Action Items
            </button>
        </div>
    </div>
</div>
